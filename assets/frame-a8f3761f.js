const S=typeof document<"u",x=d=>d;class p{constructor(){this.order=[],this.scheduled=new Set}add(e){if(!this.scheduled.has(e))return this.scheduled.add(e),this.order.push(e),!0}remove(e){const t=this.order.indexOf(e);t!==-1&&(this.order.splice(t,1),this.scheduled.delete(e))}clear(){this.order.length=0,this.scheduled.clear()}}function P(d){let e=new p,t=new p,a=0,r=!1,c=!1;const f=new WeakSet,i={schedule:(n,l=!1,u=!1)=>{const s=u&&r,o=s?e:t;return l&&f.add(n),o.add(n)&&s&&r&&(a=e.order.length),n},cancel:n=>{t.remove(n),f.delete(n)},process:n=>{if(r){c=!0;return}if(r=!0,[e,t]=[t,e],t.clear(),a=e.order.length,a)for(let l=0;l<a;l++){const u=e.order[l];u(n),f.has(u)&&(i.schedule(u),d())}r=!1,c&&(c=!1,i.process(n))}};return i}const h=["prepare","read","update","preRender","render","postRender"],R=40;function E(d,e){let t=!1,a=!0;const r={delta:0,timestamp:0,isProcessing:!1},c=h.reduce((s,o)=>(s[o]=P(()=>t=!0),s),{}),f=s=>c[s].process(r),i=()=>{const s=performance.now();t=!1,r.delta=a?1e3/60:Math.max(Math.min(s-r.timestamp,R),1),r.timestamp=s,r.isProcessing=!0,h.forEach(f),r.isProcessing=!1,t&&e&&(a=!1,d(i))},n=()=>{t=!0,a=!0,r.isProcessing||d(i)};return{schedule:h.reduce((s,o)=>{const m=c[o];return s[o]=(g,F=!1,w=!1)=>(t||n(),m.schedule(g,F,w)),s},{}),cancel:s=>h.forEach(o=>c[o].cancel(s)),state:r,steps:c}}const{schedule:q,cancel:v,state:A,steps:B}=E(typeof requestAnimationFrame<"u"?requestAnimationFrame:x,!0);export{A as a,v as c,q as f,S as i,x as n,B as s};
